resources:
- name: git-repo
  type: git
  source:
    uri: git@github.com:bvalientetecbeats/github-lambda-poc.git
    branch: concourse
    private_key: ((github_private_key))
- name: docker-image-ubuntu
  type: docker-image
  source:
    repository: ubuntu
    tag: 20.04
jobs:
  - name: build
    plan:
      - get: git-repo
        trigger: true
      - get: docker-image-ubuntu
      - task: concourse-poc
        image: docker-image-ubuntu
        config:
          platform: linux
          outputs:
          - name: workspace
          inputs:
          - name: git-repo
          run:
            path: /bin/sh
            args:
            - -c
            - |
              output_dir=workspace
              echo "Starting build..."
  - put: docker-image-ubuntu
    params:
      build: workspace
  - name: deploy-dev
    plan:
      - get: git-repo
        trigger: true
        passed: [build]
      - get: docker-image-ubuntu
        passed: [build]
      - task: concourse-poc
        image: docker-image-ubuntu
        config:
          platform: linux
          outputs:
          - name: workspace
          inputs:
          - name: git-repo
          run:
            path: /bin/sh
            args:
            - -c
            - |
              output_dir=workspace
              echo "Starting deploy to dev..."
  - name: deploy-test
    plan:
      - get: git-repo
        trigger: true
        passed: [deploy-dev]
      - get: docker-image-ubuntu
        passed: [deploy-dev]
      - task: concourse-poc
        config:
          platform: linux
          image: docker-image-ubuntu
          outputs:
          - name: workspace
          inputs:
          - name: git-repo
          run:
            path: /bin/sh
            args:
            - -c
            - |
              output_dir=workspace
              echo "Starting deploy to test..."
  - name: deploy-prod
    plan:
      - get: git-repo
        trigger: true
        passed: [deploy-test]
      - get: docker-image-ubuntu
        passed: [deploy-test]
      - task: concourse-poc
        config:
          platform: linux
          image: docker-image-ubuntu
          outputs:
          - name: workspace
          inputs:
          - name: git-repo
          run:
            path: /bin/sh
            args:
            - -c
            - |
              output_dir=workspace
              echo "Starting deploy to prod..."